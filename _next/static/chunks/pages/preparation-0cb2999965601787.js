(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[469],{6453:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/preparation",function(){return a(2026)}])},2880:function(e,t,a){"use strict";a.d(t,{j:function(){return l}});var s=a(5893),n=a(5756),i=a.n(n),o=a(1163),r=a(461);function l(){let e=(0,o.useRouter)(),[,,t]=(0,r.Z)(["access_token"]);return(0,s.jsx)("div",{className:i().all,children:(0,s.jsx)("button",{onClick:function(){t("access_token"),e.push("/")},children:(0,s.jsx)("img",{className:i().logo,src:"icons/houselogo.png"})})})}},6046:function(e,t,a){"use strict";a.d(t,{u:function(){return r}});var s=a(5893),n=a(5523),i=a.n(n),o=a(7294);function r(e){let[t,a]=(0,o.useState)(!1),[n,r]=(0,o.useState)(!1),l=(0,o.useRef)(null);(0,o.useEffect)(()=>{},[]);let c=()=>{a(!t),r(!n)};return(0,s.jsxs)("div",{className:i().all,children:[(0,s.jsx)("audio",{controls:!0,loop:!0,autoPlay:!0,className:i().audioTheme,ref:l,src:e.themeLink}),(0,s.jsx)("p",{className:i().pLegend,children:"Musique : "}),(0,s.jsx)("button",{onClick:c,children:(0,s.jsx)("p",{className:i().pButton,children:t?"OFF":"ON"})})]})}},2612:function(e,t,a){"use strict";a.d(t,{p:function(){return s}});class s{static async getRooms(){let e=await fetch("/backend/rooms",{method:"GET"}),t=await e.json();return"success"===t.status?t.data:null}static async getGameDatas(e){let t=await fetch("/backend/rooms/unique/".concat(e),{method:"GET"}),a=await t.json();return"success"===a.status?a.data[0]:null}static async createRoom(e,t){let a=Math.random().toString(36).substring(2,10),s=a+t,n=await fetch("/backend/rooms/new/".concat(s,"/").concat(e,"/").concat(t),{method:"POST"}),i=await n.json();return"success"===i.status?s:null}static async joinRoom(e,t){let a=await fetch("/backend/rooms/join/".concat(e,"/").concat(t),{method:"POST"}),s=await a.json();return"success"===s.status}static async checkReady(e){let t=await fetch("/backend/rooms/ready/".concat(e),{method:"GET"}),a=await t.json();return"success"===a.status&&a.data[0]}static async SaveCoords(e,t,a){let s=await fetch("/backend/rooms/coords",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e,isPlayerCreator:t,shipsCoord:a})}),n=await s.json();return"success"===n.status}static async Shoot(e,t,a,s){let n=await fetch("/backend/rooms/shoot",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e,isPlayerCreator:t,shootCoord:a,player1_turn:s})}),i=await n.json();return"success"===i.status}}},987:function(e,t,a){"use strict";a.d(t,{E:function(){return i}});var s=a(1354),n=a(1876).Buffer;class i{static async login(e,t){let a=(0,s.SHA256)(t),i="".concat(e,":").concat(a),o={method:"GET",Authorization:"Basic ".concat(n.from(i).toString("base64"))},r=await fetch("/backend/users/signin",{headers:o}),l=await r.json();return"success"===l.status?l.data:null}static async register(e,t){let a=(0,s.SHA256)(t),i="".concat(e,":").concat(a),o={method:"GET",Authorization:"Basic ".concat(n.from(i).toString("base64"))},r=await fetch("/backend/users/signup",{headers:o}),l=await r.json();return"success"===l.status?l.data:null}static StoreJWT(e){document.cookie="access_token=".concat(e,"; path=/;")}static async verifyAccessToken(e){let t=new Headers;t.append("Authorization","Bearer ".concat(e));let a=await fetch("/backend/verifyJWT",{headers:t}),s=await a.json();return s}static parseJwt(){let e=document.cookie;if(null!==e||void 0!==e){let t=e.split(";").find(e=>e.trim().startsWith("access_token=")).split("=")[1],a=t.split(".")[1],s=a.replace(/-/g,"+").replace(/_/g,"/"),n=JSON.parse(atob(s));return n}return null}static async checkLoginStatus(e){if(null!==e){let t=await i.verifyAccessToken(e);if(t.res)return t.res}return null}static async getUserNameById(e){if(null!==e||void 0!==e){let t=await fetch("/backend/users/".concat(e),{method:"GET"}),a=await t.json();if("success"===a.status)return a.data[0].name}return null}}},861:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return o}});var s=a(5893),n=a(4913),i=a.n(n);function o(){return(0,s.jsxs)("div",{className:i().loading,children:[(0,s.jsx)("h1",{children:"Connexion..."}),(0,s.jsx)("br",{}),(0,s.jsx)("p",{children:"En attente de connexion au serveur"})]})}},2026:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return S}});var s=a(5893),n=a(9008),i=a.n(n);class o{static async getShips(){let e=await fetch("/backend/ships"),t=await e.json();return"success"===t.status?t.data:null}}var r=a(7294),l=a(9717),c=a.n(l);function d(e){return(0,s.jsx)("div",{children:(0,s.jsx)("img",{className:c().shipsImages,src:"/ships/"+e.name.toLowerCase()+"-min.png",alt:e.name,width:184.5,height:55.5})})}var u=a(2612),p=a(987);function _(e){let t=new Audio("/sounds/pop.mp3"),a=new Audio("/sounds/readyButtonBell.mp3"),n=new Audio("/sounds/denyButton.mp3"),i=!1,[o,l]=(0,r.useState)({}),[_,h]=(0,r.useState)([{id:"A",name:"A",size:e.ships[0].longueur,direction:"horizontally",count:0,placed:!1},{id:"B",name:"B",size:e.ships[1].longueur,direction:"horizontally",count:0,placed:!1},{id:"C",name:"C",size:e.ships[2].longueur,direction:"horizontally",count:0,placed:!1},{id:"D",name:"D",size:e.ships[3].longueur,direction:"horizontally",count:0,placed:!1},{id:"E",name:"E",size:e.ships[4].longueur,direction:"horizontally",count:0,placed:!1}]),m=[];for(let e=1;e<=10;e++){let a=[];for(let n=1;n<=10;n++){let r="dropZone".concat(e,"-").concat(n);a.push((0,s.jsx)("div",{className:c().dropZone,id:r,onDrop:e=>(function(e,a){if(!1==i){e.preventDefault();let s=JSON.parse(e.dataTransfer.getData("widget")),n=Object.values(o).find(e=>(null==e?void 0:e.id)===s.id);if(n)g(o,n),f({...o,[a]:n},s,a),t.play();else{let e={...s,count:1};f({...o,[a]:e},s,a),t.play()}}})(e,r),onDragOver:y,children:o[r]&&(0,s.jsx)("div",{className:c()["dropped-widget"],onClick:()=>(function(e){if(!1==i&&o[e]){let a={...o};g(a,o[e]);let s={...o[e]};s.direction="horizontally"===s.direction?"vertically":"horizontally",f(a={...a,[e]:s},s,e),t.play()}})(r),draggable:!0,onDragStart:e=>b(e,o[r]),children:o[r].name})},r))}m.push((0,s.jsx)("div",{className:c().row,children:a},e))}function b(e,t){!1==i&&e.dataTransfer.setData("widget",JSON.stringify(t))}function y(e){!1==i&&e.preventDefault()}function f(e,t,a){if(h(e=>Object.values(e).map(e=>(e.id===t.id&&(e.placed=!0),e))),t.size>1){let[s,n]=a.substring(8).split("-").map(Number),i=[];if("vertically"===t.direction)for(let e=1;e<t.size;e++){let t="dropZone".concat(s,"-").concat(n+e);if(n+e<=10&&!o[t])i.push(t);else{i=[];break}}else for(let e=1;e<t.size;e++){let t="dropZone".concat(s+e,"-").concat(n);if(s+e<=10&&!o[t])i.push(t);else{i=[];break}}i.length===t.size-1&&(i.forEach(a=>{e={...e,[a]:{...t,count:1}}}),l(e))}else l(e)}function g(e,t){Object.keys(e).forEach(a=>{var s;(null===(s=e[a])||void 0===s?void 0:s.id)===(null==t?void 0:t.id)&&(e[a]=null)}),Object.keys(e).forEach(t=>{null===e[t]&&delete e[t]})}async function j(){if(!1==i){let t;if(t=!0,Object.values(_).forEach(e=>{e.placed||(t=!1)}),t){let t;let s=(t="",Object.entries(o).forEach(e=>{let[a,s]=e;if(s){let[e,s]=a.substring(8).split("-").map(Number);t+="".concat(e,"-").concat(s," ")}}),t),n=p.E.parseJwt().id,r=e.roomDatas.id,l=e.roomDatas.player1_id==n;await u.p.SaveCoords(r,l,s),a.play(),i=!0}else n.play(),alert("Placez tous les navires avant de confirmer !")}}return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:c().column1,children:[(0,s.jsxs)("div",{className:c().column1sub1,children:[(0,s.jsx)("div",{className:c().l1,children:"Porte-avions :"}),(0,s.jsx)("div",{className:c().l2,children:"Croiseur :"}),(0,s.jsx)("div",{className:c().l3,children:"1er contre-torpilleur :"}),(0,s.jsx)("div",{className:c().l4,children:"2\xe8me contre-torpilleur :"}),(0,s.jsx)("div",{className:c().l5,children:"Torpilleur :"})]}),(0,s.jsx)("div",{className:c().column1sub2,children:(0,s.jsx)("div",{className:c().widgets,children:_.map(function(t){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(0,s.jsx)("div",{children:(0,s.jsx)("div",{className:function(e){let t;switch(e){case 1:t=c().widgetSize1;break;case 2:t=c().widgetSize2;break;case 3:t=c().widgetSize3;break;case 4:t=c().widgetSize4;break;case 5:t=c().widgetSize5;break;default:t=c().widgetSizeDefault}return t}(t.size),draggable:!0,onDragStart:e=>b(e,t),children:(0,s.jsx)(d,{name:e.ships[a].nom,length:e.ships[a].longueur},e.ships[a].cle)},t.id)},t.id)})})})]}),(0,s.jsx)("div",{className:c().column2,children:(0,s.jsx)("div",{className:c().grid,children:m})}),(0,s.jsxs)("div",{className:c().buttonRow,children:[(0,s.jsx)("button",{onMouseDown:function(){!1==i&&(l({}),t.play(),h(e=>Object.values(e).map(e=>(e.placed=!1,e))))},className:c().btnReset,children:"R\xe9initialiser la grille"}),(0,s.jsx)("button",{onMouseDown:j,className:c().btnReady,children:"Pr\xeat !"})]})]})}var h=a(861),m=a(2880),b=a(6046),y=a(461),f=a(1163),g=a(6785),j=a.n(g);function x(e){let{roomDatas:t}=e,[a,n]=(0,r.useState)(""),[i,o]=(0,r.useState)(""),[l,c]=(0,r.useState)(!1),[d,_]=(0,r.useState)(!1);return(0,r.useEffect)(()=>{let e=setInterval(()=>{null!=t&&u.p.getGameDatas(t.id).then(e=>{if(null!==e){c(e.player1_id===p.E.parseJwt().id?e.player2_ready:e.player1_ready),_(e.player1_id===p.E.parseJwt().id?e.player1_ready:e.player2_ready);let{player1_id:t}=e;t===p.E.parseJwt().id?(null!==e.player1_id&&p.E.getUserNameById(e.player1_id).then(e=>{o(e||"")}),null!==e.player2_id&&p.E.getUserNameById(e.player2_id).then(e=>{n(e||"")})):p.E.getUserNameById(e.player1_id).then(t=>{n(t||""),null!==e.player2_id&&p.E.getUserNameById(e.player2_id).then(e=>{o(e||"")})})}})},1e3);return()=>clearInterval(e)},[]),(0,s.jsxs)("div",{className:j().div2,children:[(0,s.jsx)("h1",{className:j().lobbyTitle,children:"Lobby :"}),(0,s.jsxs)("div",{className:j().lobbyGrid,children:[(0,s.jsx)("div",{className:j().lobbyGridL1C1,children:"".concat(i)}),(0,s.jsx)("div",{className:j().lobbyGridL1C2,children:(0,s.jsx)("div",{children:"".concat(d?"est pr\xeat":"place ses bateaux")})}),(0,s.jsx)("div",{className:j().lobbyGridL1C3,children:d?(0,s.jsx)("img",{className:j().lobbyLed,src:"icons/ready_led.png"}):(0,s.jsx)("img",{className:j().lobbyLed,src:"icons/not_ready_led.png"})}),(0,s.jsx)("div",{className:j().lobbyGridL2C1,children:a?(0,s.jsx)("div",{children:"".concat(a)}):(0,s.jsx)("div",{})}),(0,s.jsx)("div",{className:j().lobbyGridL2C2,children:a?(0,s.jsx)("div",{children:"".concat(l?"est pr\xeat":"place ses bateaux")}):(0,s.jsx)("p",{children:"En attente d'un adversaire..."})}),(0,s.jsx)("div",{className:j().lobbyGridL2C3,children:a?(0,s.jsx)(s.Fragment,{children:l?(0,s.jsx)("img",{className:j().lobbyLed,src:"icons/ready_led.png"}):(0,s.jsx)("img",{className:j().lobbyLed,src:"icons/not_ready_led.png"})}):(0,s.jsx)("div",{})})]})]})}var v=a(6677),w=a.n(v);function N(){return(0,s.jsxs)("div",{className:w().div1,children:[(0,s.jsx)("h1",{className:w().rulesTitle,children:"Consignes :"}),(0,s.jsxs)("div",{className:w().rulesDiv,children:["- D\xe9placez vos navires sur la grille ",(0,s.jsx)("br",{}),"- Cliquez sur un navire pour le faire pivoter ",(0,s.jsx)("br",{}),"- Soyez s\xfbr des vos placements avant de valider"]})]})}function S(){let e=(0,f.useRouter)(),[t]=(0,y.Z)(["access_token"]),[a,n]=(0,r.useState)([]),{roomId:l}=e.query,[d,g]=(0,r.useState)([]);return((0,r.useEffect)(()=>{async function a(){1!==await p.E.checkLoginStatus(t.access_token)&&e.push("/")}async function s(){if(void 0!==l){let t=await u.p.getGameDatas(l);null!==t?(g(t),localStorage.setItem("roomDatas",JSON.stringify(t))):e.push("/404")}}async function i(){let e=await o.getShips();n(e)}let r=setInterval(()=>{u.p.checkReady(l).then(t=>{null!==t&&t.player1_ready&&t.player2_ready&&e.push("/ingame?roomId=".concat(l))})},1e3);return a(),s(),i(),()=>clearInterval(r)},[l]),0===a.length)?(0,s.jsx)(h.default,{}):void 0===l?(setTimeout(()=>{void 0===l&&e.push("/404")},2e3),(0,s.jsx)(h.default,{})):""===l?(setTimeout(()=>{""===l&&e.push("/404")},2e3),(0,s.jsx)(h.default,{})):(0,s.jsxs)("div",{className:c().all,children:[(0,s.jsxs)(i(),{children:[(0,s.jsx)("title",{children:"BATTLESHIP - BootyByters"}),(0,s.jsx)("link",{rel:"icon",href:"/steeringwheel2.ico"})]}),(0,s.jsx)(m.j,{}),(0,s.jsx)(b.u,{themeLink:"/sounds/codbo2adrenaline.mp3"}),(0,s.jsx)("div",{className:c().titlebox,children:(0,s.jsx)("p",{className:c().p1,children:"PHASE \xa0DE \xa0PREPARATION"})}),(0,s.jsxs)("div",{className:c().map,children:[(0,s.jsx)(_,{ships:a,roomDatas:d}),(0,s.jsxs)("div",{className:c().column3,children:[(0,s.jsx)(N,{}),(0,s.jsx)(x,{roomDatas:d})]})]})]})}},4913:function(e){e.exports={loading:"Loading_loading__w3J2E"}},6785:function(e){e.exports={div2:"LobbyComponent_div2__N6rpT",lobbyTitle:"LobbyComponent_lobbyTitle__FXTeT",lobbyGrid:"LobbyComponent_lobbyGrid__StEBR",lobbyGridL1C1:"LobbyComponent_lobbyGridL1C1__hs8cb",lobbyGridL1C2:"LobbyComponent_lobbyGridL1C2___Z3TJ",lobbyGridL1C3:"LobbyComponent_lobbyGridL1C3__iBixG",lobbyGridL2C1:"LobbyComponent_lobbyGridL2C1__a_sPl",lobbyGridL2C2:"LobbyComponent_lobbyGridL2C2__IeWl1",lobbyGridL2C3:"LobbyComponent_lobbyGridL2C3__Qty9t",lobbyLed:"LobbyComponent_lobbyLed__Rv8js"}},5756:function(e){e.exports={all:"MenuButton_all__paLiN",logo:"MenuButton_logo__3q_Xe"}},5523:function(e){e.exports={all:"MusicButton_all__CPL9Y",audioTheme:"MusicButton_audioTheme__l7Brl",pLegend:"MusicButton_pLegend__Vuyic",pButton:"MusicButton_pButton__zDS7w"}},9717:function(e){e.exports={all:"Preparation_all__oVlpX",titlebox:"Preparation_titlebox__ubf_k",p1:"Preparation_p1__DJ1Gi",shipsImages:"Preparation_shipsImages__tqf7w",widgets:"Preparation_widgets__CRa2_",widgetSize1:"Preparation_widgetSize1__1oKtD",widgetSize2:"Preparation_widgetSize2__xojTo",widgetSize3:"Preparation_widgetSize3__woJd_",widgetSize4:"Preparation_widgetSize4___Ix7N",widgetSize5:"Preparation_widgetSize5__kQ49a",widgetok:"Preparation_widgetok__GYOOx",grid:"Preparation_grid__AiEeX",dropZone:"Preparation_dropZone__FKW9P","dropped-widget":"Preparation_dropped-widget__ZcRJb",map:"Preparation_map__1IjcI",column1:"Preparation_column1___qLFV",column1sub1:"Preparation_column1sub1__DGupz",l1:"Preparation_l1__Ipw__",l2:"Preparation_l2__2qNuP",l3:"Preparation_l3__FKjQe",l4:"Preparation_l4__lfgvE",l5:"Preparation_l5___my9a",column1sub2:"Preparation_column1sub2__NkED7",column2:"Preparation_column2__LDo8w",column3:"Preparation_column3__M1hr0",buttonRow:"Preparation_buttonRow__L1S2g",btnReset:"Preparation_btnReset__jADTC",btnReady:"Preparation_btnReady__3eD_F"}},6677:function(e){e.exports={div1:"Rules_div1__nNcTc",rulesTitle:"Rules_rulesTitle__7dqIf",rulesDiv:"Rules_rulesDiv__Gb3y6"}},2480:function(){}},function(e){e.O(0,[570,774,888,179],function(){return e(e.s=6453)}),_N_E=e.O()}]);