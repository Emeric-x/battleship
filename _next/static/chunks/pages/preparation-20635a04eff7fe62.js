(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[469],{6453:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/preparation",function(){return s(2026)}])},2880:function(e,t,s){"use strict";s.d(t,{j:function(){return c}});var n=s(5893),a=s(5756),i=s.n(a),o=s(1163),r=s(461);function c(){const e=(0,o.useRouter)(),[,,t]=(0,r.Z)(["access_token"]);return(0,n.jsx)("div",{className:i().all,children:(0,n.jsx)("button",{onClick:function(){t("access_token"),e.push("/")},children:(0,n.jsx)("img",{className:i().logo,src:"icons/houselogo.png"})})})}},6046:function(e,t,s){"use strict";s.d(t,{u:function(){return r}});var n=s(5893),a=s(5523),i=s.n(a),o=s(7294);function r(e){const[t,s]=(0,o.useState)(!1),[a,r]=(0,o.useState)(!1),c=(0,o.useRef)(null);(0,o.useEffect)((()=>{}),[]);return(0,n.jsxs)("div",{className:i().all,children:[(0,n.jsx)("audio",{controls:!0,loop:!0,autoPlay:!0,className:i().audioTheme,ref:c,src:e.themeLink}),(0,n.jsx)("p",{className:i().pLegend,children:"Musique : "}),(0,n.jsx)("button",{onClick:()=>{s(!t),r(!a)},children:(0,n.jsx)("p",{className:i().pButton,children:t?"OFF":"ON"})})]})}},2612:function(e,t,s){"use strict";s.d(t,{p:function(){return n}});class n{static async getRooms(){const e=await fetch("/backend/rooms",{method:"GET"}),t=await e.json();return"success"===t.status?t.data:null}static async getGameDatas(e){const t=await fetch("/backend/rooms/unique/".concat(e),{method:"GET"}),s=await t.json();return"success"===s.status?s.data[0]:null}static async createRoom(e,t){const s=Math.random().toString(36).substring(2,10)+t,n=await fetch("/backend/rooms/new/".concat(s,"/").concat(e,"/").concat(t),{method:"POST"});return"success"===(await n.json()).status?s:null}static async joinRoom(e,t){const s=await fetch("/backend/rooms/join/".concat(e,"/").concat(t),{method:"POST"});return"success"===(await s.json()).status}static async checkReady(e){const t=await fetch("/backend/rooms/ready/".concat(e),{method:"GET"}),s=await t.json();return"success"===s.status&&s.data[0]}static async SaveCoords(e,t,s){const n=await fetch("/backend/rooms/coords",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e,isPlayerCreator:t,shipsCoord:s})});return"success"===(await n.json()).status}static async Shoot(e,t,s,n){const a=await fetch("/backend/rooms/shoot",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e,isPlayerCreator:t,shootCoord:s,player1_turn:n})});return"success"===(await a.json()).status}}},987:function(e,t,s){"use strict";s.d(t,{E:function(){return i}});var n=s(1354),a=s(1876).Buffer;class i{static async login(e,t){const s=(0,n.SHA256)(t),i="".concat(e,":").concat(s),o={method:"GET",Authorization:"Basic ".concat(a.from(i).toString("base64"))},r=await fetch("/backend/users/signin",{headers:o}),c=await r.json();return"success"===c.status?c.data:null}static async register(e,t){const s=(0,n.SHA256)(t),i="".concat(e,":").concat(s),o={method:"GET",Authorization:"Basic ".concat(a.from(i).toString("base64"))},r=await fetch("/backend/users/signup",{headers:o}),c=await r.json();return"success"===c.status?c.data:null}static StoreJWT(e){document.cookie="access_token=".concat(e,"; path=/;")}static async verifyAccessToken(e){const t=new Headers;t.append("Authorization","Bearer ".concat(e));const s=await fetch("/backend/verifyJWT",{headers:t});return await s.json()}static parseJwt(){const e=document.cookie;if(null!==e||void 0!==e){const t=e.split(";").find((e=>e.trim().startsWith("access_token="))).split("=")[1].split(".")[1].replace(/-/g,"+").replace(/_/g,"/");return JSON.parse(atob(t))}return null}static async checkLoginStatus(e){if(null!==e){const t=await i.verifyAccessToken(e);if(t.res)return t.res}return null}static async getUserNameById(e){if(null!==e||void 0!==e){const t=await fetch("/backend/users/".concat(e),{method:"GET"}),s=await t.json();return"success"===s.status?s.data[0].name:null}return null}}},861:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return o}});var n=s(5893),a=s(4913),i=s.n(a);function o(){return(0,n.jsxs)("div",{className:i().loading,children:[(0,n.jsx)("h1",{children:"Connexion..."}),(0,n.jsx)("br",{}),(0,n.jsx)("p",{children:"En attente de connexion au serveur"})]})}},2026:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return N}});var n=s(5893),a=s(9008),i=s.n(a);var o=s(7294),r=s(9717),c=s.n(r);function l(e){return(0,n.jsx)("div",{children:(0,n.jsx)("img",{className:c().shipsImages,src:"/ships/"+e.name.toLowerCase()+"-min.png",alt:e.name,width:184.5,height:55.5})})}var d=s(2612),u=s(987);function p(e){const t=new Audio("/sounds/pop.mp3"),s=new Audio("/sounds/readyButtonBell.mp3"),a=new Audio("/sounds/denyButton.mp3");let i=!1;const[r,p]=(0,o.useState)({}),[_,h]=(0,o.useState)([{id:"A",name:"A",size:e.ships[0].longueur,direction:"horizontally",count:0,placed:!1},{id:"B",name:"B",size:e.ships[1].longueur,direction:"horizontally",count:0,placed:!1},{id:"C",name:"C",size:e.ships[2].longueur,direction:"horizontally",count:0,placed:!1},{id:"D",name:"D",size:e.ships[3].longueur,direction:"horizontally",count:0,placed:!1},{id:"E",name:"E",size:e.ships[4].longueur,direction:"horizontally",count:0,placed:!1}]),m=[];for(let o=1;o<=10;o++){const e=[];for(let t=1;t<=10;t++){const s="dropZone".concat(o,"-").concat(t);e.push((0,n.jsx)("div",{className:c().dropZone,id:s,onDrop:e=>f(e,s),onDragOver:y,children:r[s]&&(0,n.jsx)("div",{className:c()["dropped-widget"],onClick:()=>g(s),draggable:!0,onDragStart:e=>b(e,r[s]),children:r[s].name})},s))}m.push((0,n.jsx)("div",{className:c().row,children:e},o))}function b(e,t){0==i&&e.dataTransfer.setData("widget",JSON.stringify(t))}function y(e){0==i&&e.preventDefault()}function f(e,s){if(0==i){e.preventDefault();const n=JSON.parse(e.dataTransfer.getData("widget"));let a=Object.values(r).find((e=>(null===e||void 0===e?void 0:e.id)===n.id));if(a){v(r,a),j({...r,[s]:a},n,s),t.play()}else{const e={...n,count:1};j({...r,[s]:e},n,s),t.play()}}}function g(e){if(0==i&&r[e]){let s={...r};v(s,r[e]);const n={...r[e]};n.direction="horizontally"===n.direction?"vertically":"horizontally",s={...s,[e]:n},j(s,n,e),t.play()}}function j(e,t,s){if(h((e=>Object.values(e).map((e=>(e.id===t.id&&(e.placed=!0),e))))),t.size>1){const[n,a]=s.substring(8).split("-").map(Number);let i=[];if("vertically"===t.direction)for(let e=1;e<t.size;e++){const t="dropZone".concat(n,"-").concat(a+e);if(!(a+e<=10)||r[t]){i=[];break}i.push(t)}else for(let e=1;e<t.size;e++){const t="dropZone".concat(n+e,"-").concat(a);if(!(n+e<=10)||r[t]){i=[];break}i.push(t)}i.length===t.size-1&&(i.forEach((s=>{e={...e,[s]:{...t,count:1}}})),p(e))}else p(e)}function v(e,t){Object.keys(e).forEach((s=>{var n;(null===(n=e[s])||void 0===n?void 0:n.id)===(null===t||void 0===t?void 0:t.id)&&(e[s]=null)})),Object.keys(e).forEach((t=>{null===e[t]&&delete e[t]}))}function x(e){let t;switch(e){case 1:t=c().widgetSize1;break;case 2:t=c().widgetSize2;break;case 3:t=c().widgetSize3;break;case 4:t=c().widgetSize4;break;case 5:t=c().widgetSize5;break;default:t=c().widgetSizeDefault}return t}return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:c().column1,children:[(0,n.jsxs)("div",{className:c().column1sub1,children:[(0,n.jsx)("div",{className:c().l1,children:"Porte-avions :"}),(0,n.jsx)("div",{className:c().l2,children:"Croiseur :"}),(0,n.jsx)("div",{className:c().l3,children:"1er contre-torpilleur :"}),(0,n.jsx)("div",{className:c().l4,children:"2\xe8me contre-torpilleur :"}),(0,n.jsx)("div",{className:c().l5,children:"Torpilleur :"})]}),(0,n.jsx)("div",{className:c().column1sub2,children:(0,n.jsx)("div",{className:c().widgets,children:_.map((function(t){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(0,n.jsx)("div",{children:(0,n.jsx)("div",{className:x(t.size),draggable:!0,onDragStart:e=>b(e,t),children:(0,n.jsx)(l,{name:e.ships[s].nom,length:e.ships[s].longueur},e.ships[s].cle)},t.id)},t.id)}))})})]}),(0,n.jsx)("div",{className:c().column2,children:(0,n.jsx)("div",{className:c().grid,children:m})}),(0,n.jsxs)("div",{className:c().buttonRow,children:[(0,n.jsx)("button",{onMouseDown:function(){0==i&&(p({}),t.play(),h((e=>Object.values(e).map((e=>(e.placed=!1,e))))))},className:c().btnReset,children:"R\xe9initialiser la grille"}),(0,n.jsx)("button",{onMouseDown:async function(){if(0==i){if(function(){let e=!0;return Object.values(_).forEach((t=>{t.placed||(e=!1)})),e}()){let t=function(){let e="";return Object.entries(r).forEach((t=>{let[s,n]=t;if(n){const[t,n]=s.substring(8).split("-").map(Number);e+="".concat(t,"-").concat(n," ")}})),e}(),n=u.E.parseJwt().id,a=e.roomDatas.id,o=e.roomDatas.player1_id==n;await d.p.SaveCoords(a,o,t),s.play(),i=!0}else a.play(),alert("Placez tous les navires avant de confirmer !")}},className:c().btnReady,children:"Pr\xeat !"})]})]})}var _=s(861),h=s(2880),m=s(6046),b=s(461),y=s(1163),f=s(6785),g=s.n(f);function j(e){let{roomDatas:t}=e;const[s,a]=(0,o.useState)(""),[i,r]=(0,o.useState)(""),[c,l]=(0,o.useState)(!1),[p,_]=(0,o.useState)(!1);return(0,o.useEffect)((()=>{const e=setInterval((()=>{null!==t&&void 0!==t&&d.p.getGameDatas(t.id).then((e=>{if(null!==e){l(e.player1_id===u.E.parseJwt().id?e.player2_ready:e.player1_ready),_(e.player1_id===u.E.parseJwt().id?e.player1_ready:e.player2_ready);const{player1_id:t}=e;t===u.E.parseJwt().id?(null!==e.player1_id&&u.E.getUserNameById(e.player1_id).then((e=>{r(e||"")})),null!==e.player2_id&&u.E.getUserNameById(e.player2_id).then((e=>{a(e||"")}))):u.E.getUserNameById(e.player1_id).then((t=>{a(t||""),null!==e.player2_id&&u.E.getUserNameById(e.player2_id).then((e=>{r(e||"")}))}))}}))}),1e3);return()=>clearInterval(e)}),[]),(0,n.jsxs)("div",{className:g().div2,children:[(0,n.jsx)("h1",{className:g().lobbyTitle,children:"Lobby :"}),(0,n.jsxs)("div",{className:g().lobbyGrid,children:[(0,n.jsx)("div",{className:g().lobbyGridL1C1,children:"".concat(i)}),(0,n.jsx)("div",{className:g().lobbyGridL1C2,children:(0,n.jsx)("div",{children:"".concat(p?"est pr\xeat":"place ses bateaux")})}),(0,n.jsx)("div",{className:g().lobbyGridL1C3,children:p?(0,n.jsx)("img",{className:g().lobbyLed,src:"icons/ready_led.png"}):(0,n.jsx)("img",{className:g().lobbyLed,src:"icons/not_ready_led.png"})}),(0,n.jsx)("div",{className:g().lobbyGridL2C1,children:s?(0,n.jsx)("div",{children:"".concat(s)}):(0,n.jsx)("div",{})}),(0,n.jsx)("div",{className:g().lobbyGridL2C2,children:s?(0,n.jsx)("div",{children:"".concat(c?"est pr\xeat":"place ses bateaux")}):(0,n.jsx)("p",{children:"En attente d'un adversaire..."})}),(0,n.jsx)("div",{className:g().lobbyGridL2C3,children:s?(0,n.jsx)(n.Fragment,{children:c?(0,n.jsx)("img",{className:g().lobbyLed,src:"icons/ready_led.png"}):(0,n.jsx)("img",{className:g().lobbyLed,src:"icons/not_ready_led.png"})}):(0,n.jsx)("div",{})})]})]})}var v=s(6677),x=s.n(v);function w(){return(0,n.jsxs)("div",{className:x().div1,children:[(0,n.jsx)("h1",{className:x().rulesTitle,children:"Consignes :"}),(0,n.jsxs)("div",{className:x().rulesDiv,children:["- D\xe9placez vos navires sur la grille ",(0,n.jsx)("br",{}),"- Cliquez sur un navire pour le faire pivoter ",(0,n.jsx)("br",{}),"- Soyez s\xfbr des vos placements avant de valider"]})]})}function N(){const e=(0,y.useRouter)(),[t]=(0,b.Z)(["access_token"]),[s,a]=(0,o.useState)([]),{roomId:r}=e.query,[l,f]=(0,o.useState)([]);return(0,o.useEffect)((()=>{const s=setInterval((()=>{d.p.checkReady(r).then((t=>{null!==t&&t.player1_ready&&t.player2_ready&&e.push("/ingame?roomId=".concat(r))}))}),1e3);return async function(){1!==await u.E.checkLoginStatus(t.access_token)&&e.push("/")}(),async function(){if(void 0!==r){let t=await d.p.getGameDatas(r);null!==t?(f(t),localStorage.setItem("roomDatas",JSON.stringify(t))):e.push("/404")}}(),async function(){const e=await class{static async getShips(){const e=await fetch("/backend/ships"),t=await e.json();return"success"===t.status?t.data:null}}.getShips();a(e)}(),()=>clearInterval(s)}),[r]),0===s.length?(0,n.jsx)(_.default,{}):void 0===r?(setTimeout((()=>{void 0===r&&e.push("/404")}),2e3),(0,n.jsx)(_.default,{})):""===r?(setTimeout((()=>{""===r&&e.push("/404")}),2e3),(0,n.jsx)(_.default,{})):(0,n.jsxs)("div",{className:c().all,children:[(0,n.jsxs)(i(),{children:[(0,n.jsx)("title",{children:"BATTLESHIP - BootyByters"}),(0,n.jsx)("link",{rel:"icon",href:"/steeringwheel2.ico"})]}),(0,n.jsx)(h.j,{}),(0,n.jsx)(m.u,{themeLink:"/sounds/codbo2adrenaline.mp3"}),(0,n.jsx)("div",{className:c().titlebox,children:(0,n.jsx)("p",{className:c().p1,children:"PHASE \xa0DE \xa0PREPARATION"})}),(0,n.jsxs)("div",{className:c().map,children:[(0,n.jsx)(p,{ships:s,roomDatas:l}),(0,n.jsxs)("div",{className:c().column3,children:[(0,n.jsx)(w,{}),(0,n.jsx)(j,{roomDatas:l})]})]})]})}},4913:function(e){e.exports={loading:"Loading_loading__w3J2E"}},6785:function(e){e.exports={div2:"LobbyComponent_div2__N6rpT",lobbyTitle:"LobbyComponent_lobbyTitle__FXTeT",lobbyGrid:"LobbyComponent_lobbyGrid__StEBR",lobbyGridL1C1:"LobbyComponent_lobbyGridL1C1__hs8cb",lobbyGridL1C2:"LobbyComponent_lobbyGridL1C2___Z3TJ",lobbyGridL1C3:"LobbyComponent_lobbyGridL1C3__iBixG",lobbyGridL2C1:"LobbyComponent_lobbyGridL2C1__a_sPl",lobbyGridL2C2:"LobbyComponent_lobbyGridL2C2__IeWl1",lobbyGridL2C3:"LobbyComponent_lobbyGridL2C3__Qty9t",lobbyLed:"LobbyComponent_lobbyLed__Rv8js"}},5756:function(e){e.exports={all:"MenuButton_all__paLiN",logo:"MenuButton_logo__3q_Xe"}},5523:function(e){e.exports={all:"MusicButton_all__CPL9Y",audioTheme:"MusicButton_audioTheme__l7Brl",pLegend:"MusicButton_pLegend__Vuyic",pButton:"MusicButton_pButton__zDS7w"}},9717:function(e){e.exports={all:"Preparation_all__oVlpX",titlebox:"Preparation_titlebox__ubf_k",p1:"Preparation_p1__DJ1Gi",shipsImages:"Preparation_shipsImages__tqf7w",widgets:"Preparation_widgets__CRa2_",widgetSize1:"Preparation_widgetSize1__1oKtD",widgetSize2:"Preparation_widgetSize2__xojTo",widgetSize3:"Preparation_widgetSize3__woJd_",widgetSize4:"Preparation_widgetSize4___Ix7N",widgetSize5:"Preparation_widgetSize5__kQ49a",widgetok:"Preparation_widgetok__GYOOx",grid:"Preparation_grid__AiEeX",dropZone:"Preparation_dropZone__FKW9P","dropped-widget":"Preparation_dropped-widget__ZcRJb",map:"Preparation_map__1IjcI",column1:"Preparation_column1___qLFV",column1sub1:"Preparation_column1sub1__DGupz",l1:"Preparation_l1__Ipw__",l2:"Preparation_l2__2qNuP",l3:"Preparation_l3__FKjQe",l4:"Preparation_l4__lfgvE",l5:"Preparation_l5___my9a",column1sub2:"Preparation_column1sub2__NkED7",column2:"Preparation_column2__LDo8w",column3:"Preparation_column3__M1hr0",buttonRow:"Preparation_buttonRow__L1S2g",btnReset:"Preparation_btnReset__jADTC",btnReady:"Preparation_btnReady__3eD_F"}},6677:function(e){e.exports={div1:"Rules_div1__nNcTc",rulesTitle:"Rules_rulesTitle__7dqIf",rulesDiv:"Rules_rulesDiv__Gb3y6"}},2480:function(){}},function(e){e.O(0,[570,774,888,179],(function(){return t=6453,e(e.s=t);var t}));var t=e.O();_N_E=t}]);